define("#widget/0.9.16/templatable",["./ast-printer"],function(require,exports,module){function convertTemplateToObject(template){var statements=Handlebars.parse(template).statements,html="";for(var i=0,len=statements.length;i<len;i++){var stat=statements[i];stat.type==="content"?html+=stat.string:html+="{{STAT "+i+"}}"}html=encode(html);var templateObject=$(html);return templateObject.template=html,templateObject.statements=statements,templateObject}function convertObjectToTemplate(templateObject,selector){var element=templateObject.find(selector);if(element.length===0)throw new Error("Invalid template selector: "+selector);var html=decode(element.html()),statements=templateObject.statements;return html=html.replace(STAT_RE,function(match,$1,$2){return Handlebars.print(statements[$2])}),html}function encode(template){return template.replace(STAT_RE,"<!--$1-->")}function decode(template){return template.replace(STAT_DECODE_RE,"$1")}var $=require("#jquery/1.7.2/jquery"),Handlebars=require("#handlebars/1.0.0/handlebars");Handlebars.print=require("./ast-printer").print;var Templatable={templateHelpers:null,templateObject:null,parseElementFromTemplate:function(){this.templateObject=convertTemplateToObject(this.template),this.element=$(this.compile())},compile:function(template,model){template||(template=this.template),model||(model=this.model),model.toJSON&&(model=model.toJSON());var helpers=this.templateHelpers;if(helpers)for(var name in helpers)helpers.hasOwnProperty(name)&&Handlebars.registerHelper(name,helpers[name]);var lang=this.get("lang")||{};Handlebars.registerHelper("_",function(key){return lang[key]||key});var html=Handlebars.compile(template)(model);if(helpers)for(name in helpers)helpers.hasOwnProperty(name)&&delete Handlebars.helpers[name];return delete Handlebars.helpers._,html},renderPartial:function(selector){var template=this._getTemplatePartial(selector);return this.$(selector).html(this.compile(template)),this},_getTemplatePartial:function(selector){var template;return selector?template=convertObjectToTemplate(this.templateObject,selector):template=this.template,template}};module.exports=Templatable;var STAT_RE=/({{STAT (\d+)}})/g,STAT_DECODE_RE=/(?:<|&lt;)!--({{STAT \d+}})--(?:>|&gt;)/g});