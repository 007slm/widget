define("#widget/0.9.16/widget",["./daparser","./auto-render","#base/0.9.16/aspect","#base/0.9.16/attribute","#events/0.9.1/events","#class/0.9.2/class"],function(require,exports,module){function uniqueCid(){return"widget-"+cidCounter++}function isString(val){return toString.call(val)==="[object String]"}function isFunction(val){return toString.call(val)==="[object Function]"}function isEmptyObject(o){for(var p in o)if(o.hasOwnProperty(p))return!1;return!0}function trim(s){return s.replace(/^\s*/,"").replace(/\s*$/,"")}function isInDocument(element){return contains(document.documentElement,element)}function ucfirst(str){return str.charAt(0).toUpperCase()+str.substring(1)}function normalizeConfigValues(config){for(var p in config)if(config.hasOwnProperty(p)){var val=config[p];if(!isString(val))continue;JSON_LITERAL_PATTERN.test(val)?(val=val.replace(/'/g,'"'),config[p]=normalizeConfigValues(parseJSON(val))):config[p]=normalizeConfigValue(val)}return config}function normalizeConfigValue(val){if(val.toLowerCase()==="false")val=!1;else if(val.toLowerCase()==="true")val=!0;else if(/\d/.test(val)&&/[^a-z]/i.test(val)){var number=parseFloat(val);number+""===val&&(val=number)}return val}function parseDataActions(actions,events){for(var action in actions){if(!actions.hasOwnProperty(action))continue;var parts=trim(action).split(/\s*,\s*/),selector=actions[action];while(action=parts.shift()){var m=action.split(/\s+/),event=m[0],method=m[1];method||(method=event,event="click"),events[event+" "+selector]=method}}}function isEmptyAttrValue(o){return o==null||(isString(o)||$.isArray(o))&&o.length===0||$.isPlainObject(o)&&isEmptyObject(o)}function getEvents(widget){return isFunction(widget.events)&&(widget.events=widget.events()),widget.events}function parseEventKey(eventKey,widget){var match=eventKey.match(EVENT_KEY_SPLITTER),eventType=match[1]+DELEGATE_EVENT_NS+widget.cid,selector=match[2]||undefined;return selector&&selector.indexOf("{{")>-1&&(selector=parseEventExpression(selector,widget)),{type:eventType,selector:selector}}function parseEventExpression(selector,widget){return selector.replace(EXPRESSION_FLAG,function(m,name){var parts=name.split("."),point=widget,part;while(part=parts.shift())point===widget.attrs?point=widget.get(part):point=point[part];if(isString(point))return point;var element=$(point)[0];return element&&element.nodeType===1?"."+DAParser.stamp(element):INVALID_SELECTOR})}var Base=require("#base/0.9.16/base"),$=require("#jquery/1.7.2/jquery"),DAParser=require("./daparser"),AutoRender=require("./auto-render"),DELEGATE_EVENT_NS=".delegate-events-",ON_RENDER="_onRender",Widget=Base.extend({propsInAttrs:["element","template","model","events"],element:null,template:"<div></div>",model:null,events:null,attrs:{id:"",className:"",style:{},parentNode:document.body},initialize:function(config){this.cid=uniqueCid();var dataAttrsConfig=this._parseDataAttrsConfig(config);this.initAttrs(config,dataAttrsConfig),this.parseElement(),this._parseDataset(),this.initProps(),this.delegateEvents(),this.setup()},_parseDataAttrsConfig:function(config){var dataAttrsConfig;if(config)var element=$(config.element);return element&&element[0]&&!AutoRender.isDataApiOff(element)&&(dataAttrsConfig=DAParser.parseElement(element),normalizeConfigValues(dataAttrsConfig)),dataAttrsConfig},parseElement:function(){var element=this.element;element?this.element=$(element):this.get("template")&&this.parseElementFromTemplate();if(!this.element||!this.element[0])throw new Error("element is invalid")},parseElementFromTemplate:function(){this.element=$(this.get("template"))},_parseDataset:function(){if(AutoRender.isDataApiOff(this.element))return;this.dataset=DAParser.parseBlock(this.element);var actions=this.dataset.action;if(actions){var events=getEvents(this)||(this.events={});parseDataActions(actions,events)}},initProps:function(){},delegateEvents:function(events,handler){events||(events=getEvents(this));if(!events)return;if(isString(events)&&isFunction(handler)){var o={};o[events]=handler,events=o}for(var key in events){if(!events.hasOwnProperty(key))continue;var args=parseEventKey(key,this),eventType=args.type,selector=args.selector;(function(handler,widget){var callback=function(ev){isFunction(handler)?handler.call(widget,ev):widget[handler](ev)};selector?widget.element.on(eventType,selector,callback):widget.element.on(eventType,callback)})(events[key],this)}return this},undelegateEvents:function(eventKey){var args={};return arguments.length===0?args.type=DELEGATE_EVENT_NS+this.cid:args=parseEventKey(eventKey,this),this.element.off(args.type,args.selector),this},setup:function(){},render:function(){this.rendered||(this._renderAndBindAttrs(),this.rendered=!0);var parentNode=this.get("parentNode");return parentNode&&!isInDocument(this.element[0])&&this.element.appendTo(parentNode),this},_renderAndBindAttrs:function(){var widget=this,attrs=widget.attrs;for(var attr in attrs){if(!attrs.hasOwnProperty(attr))continue;var m=ON_RENDER+ucfirst(attr);if(this[m]){var val=this.get(attr);isEmptyAttrValue(val)||this[m](this.get(attr),undefined,attr),function(m){widget.on("change:"+attr,function(val,prev,key){widget[m](val,prev,key)})}(m)}}},_onRenderId:function(val){this.element.attr("id",val)},_onRenderClassName:function(val){this.element.addClass(val)},_onRenderStyle:function(val){this.element.css(val)},$:function(selector){return this.element.find(selector)},destroy:function(){this.undelegateEvents(),Widget.superclass.destroy.call(this)}});Widget.autoRender=AutoRender.autoRender,Widget.autoRenderAll=AutoRender.autoRenderAll,Widget.StaticsWhiteList=["autoRender"],module.exports=Widget;var toString=Object.prototype.toString,cidCounter=0,contains=$.contains||function(a,b){return!!(a.compareDocumentPosition(b)&16)},JSON_LITERAL_PATTERN=/^\s*[\[{].*[\]}]\s*$/,parseJSON=this.JSON?JSON.parse:$.parseJSON,EVENT_KEY_SPLITTER=/^(\S+)\s*(.*)$/,EXPRESSION_FLAG=/{{([^}]+)}}/g,INVALID_SELECTOR="INVALID_SELECTOR"});